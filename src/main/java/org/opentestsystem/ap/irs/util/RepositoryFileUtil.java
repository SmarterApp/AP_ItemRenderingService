package org.opentestsystem.ap.irs.util;

import java.nio.file.Path;
import java.nio.file.Paths;

import lombok.extern.slf4j.Slf4j;
import org.opentestsystem.ap.common.config.ItemBankProperties;
import org.opentestsystem.ap.irs.config.IvsServiceProperties;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import static org.apache.commons.io.FileUtils.copyDirectory;
import static org.apache.commons.lang3.RandomStringUtils.randomAlphabetic;

/**
 * Created by alexponce on 6/22/17.
 */
@Slf4j
@Component
public class RepositoryFileUtil {

    private final IvsServiceProperties ivsServiceProps;
    private final ItemBankProperties itemBankProperties;

    @Autowired
    public RepositoryFileUtil(final IvsServiceProperties ivsProps, final ItemBankProperties itemBankProps) {
        ivsServiceProps = ivsProps;
        itemBankProperties = itemBankProps;
    }

    public void copyRepositoryToRenderDir(Path sourceLocation, String itemId) {
        final String randomFolderName = randomAlphabetic(itemBankProperties.getRandomRepoFolderCharLength());
        final Path destinationDir = Paths.get(ivsServiceProps.getIvsBaseDir(), randomFolderName, itemId);
        try {
            copyDirectory(sourceLocation.toFile(), destinationDir.toFile());
            log.info("Repository copied successfully");
        } catch (Exception ex) {
            log.error("Unable to copy files from " + sourceLocation.toString() + " to " + destinationDir, ex);
        }
    }

}
