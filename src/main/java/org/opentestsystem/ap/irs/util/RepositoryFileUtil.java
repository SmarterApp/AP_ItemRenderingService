package org.opentestsystem.ap.irs.util;

import lombok.extern.slf4j.Slf4j;
import org.apache.commons.io.FileUtils;
import org.apache.commons.lang3.RandomStringUtils;
import org.opentestsystem.ap.common.config.ItemBankProperties;
import org.opentestsystem.ap.irs.config.IvsServiceProperties;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import java.io.File;
import java.nio.file.Path;

/**
 * Created by alexponce on 6/22/17.
 */
@Slf4j
@Component
public class RepositoryFileUtil {

    private final IvsServiceProperties ivsServiceProps;
    private final ItemBankProperties itemBankProperties;

    @Autowired
    public RepositoryFileUtil(final IvsServiceProperties ivsProps,
                              final ItemBankProperties itemBankProps) {
        ivsServiceProps = ivsProps;
        itemBankProperties = itemBankProps;
    }

    public void copyRepositoryToRenderDir(Path sourceLocation, String itemId) {
        final String randomFolderName = RandomStringUtils.randomAlphabetic(itemBankProperties.getRandomRepoFolderCharLength());
        final String destinationDir = ivsServiceProps.getIvsBaseDir() + "/" + randomFolderName + "/" + itemId;
        try {
            FileUtils.copyDirectory(
                    sourceLocation.toFile(),
                    new File(destinationDir)
            );
            log.info("Repository copied successfully");
        } catch (Exception ex) {
            log.error("Unable to copy files from " + sourceLocation.toString() + " to " + destinationDir, ex);
        }
    }

}
